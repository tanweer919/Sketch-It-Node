<html>
  <body>
    <div id="message-container"><ul id="messages"></ul></div>
    <label for="roomName">Room Name</label>
    <input type="text" id="roomName" /><br />
    <label for="roomNumber">Room Number</label>
    <input type="text" id="roomNumber" /><br />
    <label for="maxPlayers">Max Players</label>
    <input type="text" id="maxPlayers" /><br />
    <button id="createRoomButton">Create room</button><br />
    <label>Enter Room Number:</label>
    <input id="roomNumberInput" type="text" />
    <button id="roomButton">Join Room</button><br />
    <input type="text" id="messageInput" />
    <button id="messageButton">Send Message</button>
    <script src="https://cdn.socket.io/socket.io-3.0.1.min.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>

    <script>
      var roomNumber;
      var typing = false;
      var timeout = undefined;
      let socket = io();
      const timeoutFunction = () => {
        typing = false;
        socket.emit("notTyping", roomNumber);
      };

      $("#messageInput").keypress(() => {
        if (typing == false) {
          console.log("typing");
          typing = true;
          socket.emit("typing", roomNumber);
          timeout = setTimeout(timeoutFunction, 5000);
        } else {
          clearTimeout(timeout);
          timeout = setTimeout(timeoutFunction, 5000);
        }
      });
      socket.on("typing", () => {
        console.log("someone is typing");
        $("#message-container").append(
          '<span id="typing">Someone is typing</span>'
        );
      });
      socket.on("notTyping", () => {
        $("#typing").remove();
      });
      $("#roomButton").on("click", () => {
        const val = $("#roomNumberInput").val();
        socket.emit("join room", val);
        roomNumber = val;
      });
      socket.on("new message", (message) => {
        $("#messages").append(`<li>${message}</li>`);
      });
      $("#messageButton").on("click", () => {
        const val = $("#messageInput").val();
        socket.emit("new message", val, roomNumber);
      });
      $("#createRoomButton").on("click", () => {
        const name = $("#roomName").val();
        const number = $("#roomNumber").val();
        const maxPlayers = $("#maxPlayers").val();
        roomNumber = number;
        console.log(name, roomNumber, maxPlayers);
        socket.emit("create room", name, number, maxPlayers);
      });
    </script>
  </body>
</html>
